---
import ProductGrid from '@/components/product/ProductGrid.astro';
import Button from '@/components/ui/Button.astro';
import { getCollection } from 'astro:content';

const products = await getCollection('products');
const featuredProducts = products
  .filter((p) => p.data.featured)
  .slice(0, 8)
  .map((p) => p.data);
---

<section class="ma-section bg-white relative overflow-hidden">
  <!-- Decorative background -->
  <div class="absolute top-0 right-0 w-96 h-96 bg-pink-50 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 opacity-60"></div>
  <div class="absolute bottom-0 left-0 w-64 h-64 bg-stone-100 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2 opacity-60"></div>

  <div class="japandi-container relative">
    <!-- Section header -->
    <div class="text-center mb-14">
      <span class="inline-block px-4 py-1.5 bg-pink-50 text-pink-600 text-sm font-medium tracking-wider rounded-full mb-4">
        Bán chạy nhất
      </span>
      <h2 class="text-3xl lg:text-4xl font-medium text-stone-800 mb-4">
        Sản phẩm <span class="gradient-text">nổi bật</span>
      </h2>
      <p class="text-stone-500 max-w-lg mx-auto text-lg">
        Những sản phẩm được khách hàng yêu thích và tin tưởng nhất
      </p>
    </div>

    {featuredProducts.length > 0 ? (
      <div class="stagger-children">
        <ProductGrid products={featuredProducts} columns={4} />
      </div>
    ) : (
      <div class="text-center py-16 bg-stone-50 rounded-2xl">
        <div class="w-16 h-16 mx-auto mb-4 bg-pink-100 rounded-full flex items-center justify-center">
          <svg class="w-8 h-8 text-pink-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
          </svg>
        </div>
        <p class="text-stone-400 text-lg">Đang cập nhật sản phẩm...</p>
      </div>
    )}

    <div class="text-center mt-14">
      <Button variant="outline" size="lg" href="/products" class="group">
        <span>Xem tất cả sản phẩm</span>
        <svg class="w-5 h-5 ml-2 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </Button>
    </div>
  </div>
</section>
